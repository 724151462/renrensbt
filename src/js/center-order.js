/**
 * mock订单列表
 */
var mockOrder = {
	"returnCode": "1",
	"returnMsg": "success",
	"returnParams": [{
		"actual_amount": 8321.76,
		"canbaojin_company": 0,
		"canbaojin_person": 0,
		"canbaojin_total": 0,
		"city_name": "宁德市",
		"cityid": 0,
		"createdate": "2020-02-03 09:08:36",
		"dabingyiliao_company": 60,
		"dabingyiliao_person": 0,
		"dabingyiliao_total": 60,
		"discounts_amount": 0,
		"end_date": "2020-04",
		"gongshang_company": 40,
		"gongshang_person": 0,
		"gongshang_total": 40,
		"housing": 4233,
		"housing_company": 507.96,
		"housing_person": 507.96,
		"housing_total": 1015.92,
		"hukou_category": "农村户口",
		"insurance_amount": 8227.26,
		"insurancetype": "统一",
		"isBuyHousing": 1,
		"is_canbaojin": "0",
		"is_dabingyiliao": "1",
		"isread": 0,
		"manager_cost": 94.5,
		"operator": 436209644565981,
		"order_amount": 8321.76,
		"ordermonth": 3,
		"orderno": "20200203090836590297217954403",
		"ordertype": 1,
		"orderuser": 590260119453683,
		"orderuser_cardnum": "3505",
		"orderuser_name": "wjx",
		"orderuser_phone": "18459183928",
		"pay_time": "",
		"province_name": "福建省",
		"provinceid": 350000,
		"remark": "42",
		"shengyu_company": 22.22,
		"shengyu_person": 0,
		"shengyu_total": 22.22,
		"shiye_company": 22.22,
		"shiye_person": 22.22,
		"shiye_total": 44.44,
		"start_date": "2020-02",
		"state": 0,
		"universalid": 590297216880286,
		"yanglao": 4444,
		"yanglao_company": 799.92,
		"yanglao_person": 355.52,
		"yanglao_total": 1155.44,
		"yiliao_company": 355.52,
		"yiliao_person": 88.88,
		"yiliao_total": 444.4
	},{
		"actual_amount": 8321.76,
		"canbaojin_company": 0,
		"canbaojin_person": 0,
		"canbaojin_total": 0,
		"city_name": "宁德市",
		"cityid": 0,
		"createdate": "2020-02-03 09:08:36",
		"dabingyiliao_company": 60,
		"dabingyiliao_person": 0,
		"dabingyiliao_total": 60,
		"discounts_amount": 0,
		"end_date": "2020-04",
		"gongshang_company": 40,
		"gongshang_person": 0,
		"gongshang_total": 40,
		"housing": 4233,
		"housing_company": 507.96,
		"housing_person": 507.96,
		"housing_total": 1015.92,
		"hukou_category": "农村户口",
		"insurance_amount": 8227.26,
		"insurancetype": "统一",
		"isBuyHousing": 1,
		"is_canbaojin": "0",
		"is_dabingyiliao": "1",
		"isread": 0,
		"manager_cost": 94.5,
		"operator": 436209644565981,
		"order_amount": 8321.76,
		"ordermonth": 3,
		"orderno": "20200203090836590297217954403",
		"ordertype": 1,
		"orderuser": 590260119453683,
		"orderuser_cardnum": "3505",
		"orderuser_name": "wjx",
		"orderuser_phone": "18459183928",
		"pay_time": "",
		"province_name": "福建省",
		"provinceid": 350000,
		"remark": "42",
		"shengyu_company": 22.22,
		"shengyu_person": 0,
		"shengyu_total": 22.22,
		"shiye_company": 22.22,
		"shiye_person": 22.22,
		"shiye_total": 44.44,
		"start_date": "2020-02",
		"state": 0,
		"universalid": 590297216880286,
		"yanglao": 4444,
		"yanglao_company": 799.92,
		"yanglao_person": 355.52,
		"yanglao_total": 1155.44,
		"yiliao_company": 355.52,
		"yiliao_person": 88.88,
		"yiliao_total": 444.4
	},{
		"actual_amount": 8321.76,
		"canbaojin_company": 0,
		"canbaojin_person": 0,
		"canbaojin_total": 0,
		"city_name": "宁德市",
		"cityid": 0,
		"createdate": "2020-02-03 09:08:36",
		"dabingyiliao_company": 60,
		"dabingyiliao_person": 0,
		"dabingyiliao_total": 60,
		"discounts_amount": 0,
		"end_date": "2020-04",
		"gongshang_company": 40,
		"gongshang_person": 0,
		"gongshang_total": 40,
		"housing": 4233,
		"housing_company": 507.96,
		"housing_person": 507.96,
		"housing_total": 1015.92,
		"hukou_category": "农村户口",
		"insurance_amount": 8227.26,
		"insurancetype": "统一",
		"isBuyHousing": 1,
		"is_canbaojin": "0",
		"is_dabingyiliao": "1",
		"isread": 0,
		"manager_cost": 94.5,
		"operator": 436209644565981,
		"order_amount": 8321.76,
		"ordermonth": 3,
		"orderno": "20200203090836590297217954403",
		"ordertype": 1,
		"orderuser": 590260119453683,
		"orderuser_cardnum": "3505",
		"orderuser_name": "wjx",
		"orderuser_phone": "18459183928",
		"pay_time": "",
		"province_name": "福建省",
		"provinceid": 350000,
		"remark": "42",
		"shengyu_company": 22.22,
		"shengyu_person": 0,
		"shengyu_total": 22.22,
		"shiye_company": 22.22,
		"shiye_person": 22.22,
		"shiye_total": 44.44,
		"start_date": "2020-02",
		"state": 0,
		"universalid": 590297216880286,
		"yanglao": 4444,
		"yanglao_company": 799.92,
		"yanglao_person": 355.52,
		"yanglao_total": 1155.44,
		"yiliao_company": 355.52,
		"yiliao_person": 88.88,
		"yiliao_total": 444.4
	}]
}
$(function() {
	if (sessionStorage.getItem('centerTab') == 0) {
		initOrder("''")
	}
	$('.center-tab').find('span').each(function() {
		$(this).click(function(event) {
			console.log($(this))
			$('.center-tab').find('span').removeClass('center-tab-active')
			$(this).addClass('center-tab-active')
			$('#tab-container').html('')
			var content = ''
			console.log($(event.target).text())
			if ($(event.target).text() == '全部') {
				// mockOrder['data|5'][0]['orderState|1'] = ["1", "2"]
				initOrder("''")
			} else if ($(event.target).text() == '待付款') {
				// mockOrder['data|5'][0]['orderState|1'] = ["1"]
				initOrder(0)
			} else {
				// mockOrder['data|5'][0]['orderState|1'] = ["2"]
				initOrder(1)
			}
		})
	})
})

var baseUrl = 'http://www.rrsbt.com/clientServices.do?iscrypt=1'
// var baseUrl = 'http://leideqiang.w3.luyouxia.net/oa/clientServices.do?iscrypt=1'
// var baseUrl = 'http://leideqiang.w3.luyouxia.net/insurance/clientServices.do?iscrypt=1'

/**
 * 初始化订单
 */
function initOrder(state) {
	// Mock.mock('https://api/center/order', mockOrder)
	if (sessionStorage.getItem('login')) {
		var useId = JSON.parse(sessionStorage.getItem('login')).useId
	}
	// openPreloader()
	console.log(useId)
	$.ajax({
		url: baseUrl,
		// url: 'https://api/center/order',
		type: 'POST',
		contentType: "application/json; charset=utf-8",
		data: `{"serviceId":"eu_2013V01OrderApi","params":{"orderType":1,"state":${state},"useId":"${useId}"}}`,
		// $.get('https://api/center/order',

		success: function(data) {
			if (JSON.parse(data).returnCode == 0) {
				var content =
					`<div class="fr-center-message-div" style="text-align: center;margin-top:20%">
					<img src="./images/center-message.png" />
				</div>`
			} else {
				var allOrders = JSON.parse(data).returnParams
				var content = ''
				for (let i = 0; i < allOrders.length; i++) {
					console.log(typeof(allOrders[i].orderno))
					content +=
						`
											<div class="order-item order-row fr-order-itme-top">
												<div class="row order-title fr-order-sj">
													<div>
														<span>订单号123:</span><span id="orderNumber" class="order-number"> ${allOrders[i].orderno}</span><a style="color:rgb(27,155, 227)" class="mar-l-10" onclick="orderCopy()">复制</a>
													</div>	
													<div>
														<span>状态: </span>${allOrders[i].state == '0'?'<span style="color:rgb(27,155, 227)">待付款</span>':'<span style="color:rgb(48,192,88)">已付款</span>'}
													</div>
												</div>
												<div class="order-body">
													<div class="fr-order-bd-w">
													
															<div class="order-row fr-order-float">
																<span>参保用户：</span><span>${allOrders[i].orderuser_name}</span>
															</div>
															<div class="order-row fr-order-float fr-order-float-yd">
																<span>参保城市：</span><span>${allOrders[i].city_name}</span>
															</div>										
														
															<div class="order-row fr-order-float">
																<span>缴纳类型：</span><span class='text-of type-width'>${allOrders[i].insurancetype}</span>
															</div>
															<div class="order-row fr-order-float fr-order-float-yd" >
																<span>缴纳周期: </span><span>${allOrders[i].ordermonth}个月</span>
															</div>
															<div class="order-row fr-order-float fr-order-float-yd-rq">
																<span>缴纳日期：</span><span>${allOrders[i].start_date}</span>
															</div>
													</div>
													<div class="fr-order-jg">
														<div class="order-row">
															<span class="order-amount">￥${allOrders[i].actual_amount}</span>
														</div>
													</div>
												</div>
												<div class="operate-btn">
													<button type="button" class="btn fr-order-btn-t-c">删除</button>
													<button style="${allOrders[i].orderState == '已付款' ? 'display: none' : ''}" class="btn btn-primary" onclick="payOrder('${allOrders[i].orderno}')">付款</button>
												</div>
											</div>
											`


				}

			}
			$('#tab-container').html(content)
			// handlePreloader()
		}
	})
}

function payOrder(orderNum) {
	console.log(orderNum)
	$.ajax({
		url: baseUrl,
		type: 'POST',
		contentType: "application/json; charset=utf-8",
		data: `{"serviceId":"eu_2013V01wxH5PayApi","params":{"orderId":"${orderNum}"}}`,
		success: function(data) {},
	})
}

function orderCopy() {
	var text =document.getElementById("orderNumber").innerText;
	        var input = document.createElement('input');
	        input.setAttribute('id', 'copyInput');
	        input.setAttribute('value', text);
	        document.getElementsByTagName('body')[0].appendChild(input);
	        document.getElementById('copyInput').select();
	        if (document.execCommand('copy')) {
	            alert('复制成功');
	        }
	        document.getElementById('copyInput').remove();
}